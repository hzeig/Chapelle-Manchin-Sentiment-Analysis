facet_wrap(~ Year) +
labs(title = "Monthly Containers", subtitle="by company per year",
y = "Monthly Containers (100k)", x = "Company")
View(idf)
month(cdf$Week)
cdf$Month <- month(cdf$Week)
cdf$Year <- year(cdf$Year)
cdf$Year <- year(cdf$Week)
cdf$Month <- month(cdf$Week)
cdf$Year <- year(cdf$Week)
idf$Month <- month(idf$Date)
idf$Year <- year(idf$Date)
#
# cdf <- cdf %>%
#   mutate(Month= month(Week),
#             Year= year(Week))
# idf <- idf %>%
#   mutate(Month= month(Date),
#             Year= year(Date))
cdf %>%
group_by(Month, Commodity, Company) %>%
summarise(Monthly.Carloads = sum(Carloads))
cdf$Month
cdf %>%
group_by(Year,Month, Commodity, Company) %>%
summarise(Monthly.Carloads = sum(Carloads))
df <- merge(cdf,idf, all=T)
cdf %>%
group_by(Month,Year,Company, Commodity) %>%
filter(Commodity == "Containers") %>%
summarise(Monthly.Containers = sum(Carloads)) %>%
ggplot(aes(x = fct_reorder(Company, Monthly.Containers), y= Monthly.Containers)) +
geom_boxplot() +
facet_wrap(~ Year) +
labs(title = "Monthly Containers", subtitle="by company per year",
y = "Monthly Containers (100k)", x = "Company")
View(idf)
idf$Month <- month(idf$Date)
idf$Year <- year(idf$Date)
View(idf)
idf$Month <- month(mdy(idf$Date))
idf$Year <- year(mdy(idf$Date))
library(dplyr)
library(tidyr)
library(ggplot2)
library(lubridate)
cdf <- read.csv("carloads.csv")
idf <- read.csv("ism.csv")
cdf <- cdf %>%  filter(Measure=='Weekly Carloads By 22 Commodity Categories' & Sub.Variable == 'Total')
cdf <- cdf %>% pivot_longer(!c(1:6), names_to = "Week", values_to = "Carload")
str(cdf)
cdf <- cdf %>% select(Company, Commodity=Variable, Week, Carloads=Carload)
cdf$Week <- sub("^X","",cdf$Week)
cdf$Carloads <- as.numeric(sub(",", "", cdf$Carloads))
cdf$Week <- as.Date(cdf$Week, "%m.%d.%Y")
cdf$Month <- month(cdf$Week)
cdf$Year <- year(cdf$Week)
idf$Month <- month(mdy(idf$Date))
idf$Year <- year(mdy(idf$Date))
#
# cdf <- cdf %>%
#   mutate(Month= month(Week),
#             Year= year(Week))
# idf <- idf %>%
#   mutate(Month= month(Date),
#             Year= year(Date))
cdf %>%
group_by(Year,Month, Commodity, Company) %>%
summarise(Monthly.Carloads = sum(Carloads))
df <- merge(cdf,idf, all=T)
library(forcats)
cdf %>%
group_by(Month,Year,Company, Commodity) %>%
filter(Commodity == "Containers") %>%
summarise(Monthly.Containers = sum(Carloads)) %>%
ggplot(aes(x = fct_reorder(Company, Monthly.Containers), y= Monthly.Containers)) +
geom_boxplot() +
facet_wrap(~ Year) +
labs(title = "Monthly Containers", subtitle="by company per year",
y = "Monthly Containers (100k)", x = "Company")
df %>%
group_by(Year,Month, Commodity, Company) %>%
summarise(Monthly.Index = sum(),
Monthly.Carloads = sum(Carloads))
cor(df$)
View(cdf)
# cdf$Month <- month(cdf$Week)
# cdf$Year <- year(cdf$Week)
# idf$Month <- month(mdy(idf$Date))
# idf$Year <- year(mdy(idf$Date))
#
cdf <- cdf %>%
mutate(Month= month(ymd(Week)),
Year= year(ymd(Week)))
idf <- idf %>%
mutate(Month= month(mdy(Date)),
Year= year(mdy(Date)))
library(dplyr)
library(tidyr)
library(ggplot2)
library(lubridate)
cdf <- read.csv("carloads.csv")
idf <- read.csv("ism.csv")
cdf <- cdf %>%  filter(Measure=='Weekly Carloads By 22 Commodity Categories' & Sub.Variable == 'Total')
cdf <- cdf %>% pivot_longer(!c(1:6), names_to = "Week", values_to = "Carload")
str(cdf)
cdf <- cdf %>% select(Company, Commodity=Variable, Week, Carloads=Carload)
cdf$Week <- sub("^X","",cdf$Week)
cdf$Carloads <- as.numeric(sub(",", "", cdf$Carloads))
cdf$Week <- as.Date(cdf$Week, "%m.%d.%Y")
# cdf$Month <- month(cdf$Week)
# cdf$Year <- year(cdf$Week)
# idf$Month <- month(mdy(idf$Date))
# idf$Year <- year(mdy(idf$Date))
#
cdf <- cdf %>%
mutate(Month= month(ymd(Week)),
Year= year(ymd(Week)))
idf <- idf %>%
mutate(Month= month(mdy(Date)),
Year= year(mdy(Date)))
cdf %>%
group_by(Year,Month, Commodity, Company) %>%
summarise(Monthly.Carloads = sum(Carloads))
df <- merge(cdf,idf, all=T)
library(forcats)
cdf %>%
group_by(Month,Year,Company, Commodity) %>%
filter(Commodity == "Containers") %>%
summarise(Monthly.Containers = sum(Carloads)) %>%
ggplot(aes(x = fct_reorder(Company, Monthly.Containers), y= Monthly.Containers)) +
geom_boxplot() +
facet_wrap(~ Year) +
labs(title = "Monthly Containers", subtitle="by company per year",
y = "Monthly Containers (100k)", x = "Company")
df %>%
group_by(Year,Month, Commodity, Company) %>%
summarise(Monthly.Index = sum(),
Monthly.Carloads = sum(Carloads))
cor(df$)
df %>%
group_by(Year, Month, Index, Commodity, Company) %>%
summarise(Monthly.Carloads = sum(Carloads))
cor(df$Index, df$Monthly.Carloads)
df %>%
group_by(Year, Month, Index, Commodity, Company) %>%
summarise(Monthly.Carloads = sum(Carloads)) %>%
cor(Index, Monthly.Carloads)
df %>%
group_by(Year, Month, Index, Commodity, Company) %>%
mutate(Monthly.Carloads = sum(Carloads)) %>%
cor(Index, Monthly.Carloads)
df %>%
group_by(Year, Month, Index, Commodity, Company) %>%
summarise(Monthly.Carloads = sum(Carloads)) %>%
cor(Index, Month)
cor(df2$Index, df2$Month)
df2 <- df %>%
group_by(Year, Month, Index, Commodity, Company) %>%
summarise(Monthly.Carloads = sum(Carloads))
cor(df2$Index, df2$Month)
df2 <- df %>%
group_by(Month) %>%
summarise(Index, Monthly.Carloads = sum(Carloads))
cdf <- cdf %>%
group_by(Year,Month, Commodity, Company) %>%
summarise(Monthly.Carloads = sum(Carloads))
df <- merge(cdf,idf, all=T)
View(df)
cdf %>%
group_by(Month,Year,Company, Commodity) %>%
filter(Commodity == "Containers") %>%
summarise(Monthly.Containers = sum(Carloads)) %>%
ggplot(aes(x = fct_reorder(Company, Monthly.Containers), y= Monthly.Containers)) +
geom_boxplot() +
facet_wrap(~ Year) +
labs(title = "Monthly Containers", subtitle="by company per year",
y = "Monthly Containers (100k)", x = "Company")
cdf %>%
group_by(Month,Year,Company, Commodity) %>%
filter(Commodity == "Containers") %>%
ggplot(aes(x = fct_reorder(Company, Monthly.Containers), y= Monthly.Containers)) +
geom_boxplot() +
facet_wrap(~ Year) +
labs(title = "Monthly Containers", subtitle="by company per year",
y = "Monthly Containers (100k)", x = "Company")
cdf %>%
group_by(Month,Year,Company, Commodity) %>%
filter(Commodity == "Containers") %>%
ggplot(aes(x = fct_reorder(Company, Commodity), y= Commodity)) +
geom_boxplot() +
facet_wrap(~ Year) +
labs(title = "Monthly Containers", subtitle="by company per year",
y = "Monthly Containers (100k)", x = "Company")
cdf2 <- cdf %>%
group_by(Year,Month, Commodity, Company) %>%
summarise(Monthly.Carloads = sum(Carloads))
library(dplyr)
library(tidyr)
library(ggplot2)
library(lubridate)
cdf <- read.csv("carloads.csv")
idf <- read.csv("ism.csv")
cdf <- cdf %>%  filter(Measure=='Weekly Carloads By 22 Commodity Categories' & Sub.Variable == 'Total')
cdf <- cdf %>% pivot_longer(!c(1:6), names_to = "Week", values_to = "Carload")
str(cdf)
cdf <- cdf %>% select(Company, Commodity=Variable, Week, Carloads=Carload)
cdf$Week <- sub("^X","",cdf$Week)
cdf$Carloads <- as.numeric(sub(",", "", cdf$Carloads))
cdf$Week <- as.Date(cdf$Week, "%m.%d.%Y")
# cdf$Month <- month(cdf$Week)
# cdf$Year <- year(cdf$Week)
# idf$Month <- month(mdy(idf$Date))
# idf$Year <- year(mdy(idf$Date))
#
cdf <- cdf %>%
mutate(Month= month(ymd(Week)),
Year= year(ymd(Week)))
idf <- idf %>%
mutate(Month= month(mdy(Date)),
Year= year(mdy(Date)))
cdf2 <- cdf %>%
group_by(Year,Month, Commodity, Company) %>%
summarise(Monthly.Carloads = sum(Carloads))
df <- merge(cdf2,idf, all=T)
library(forcats)
cdf %>%
group_by(Month,Year,Company, Commodity) %>%
filter(Commodity == "Containers") %>%
summarise(Monthly.Containers = sum(Carloads)) %>%
ggplot(aes(x = fct_reorder(Company, Monthly.Containers), y= Monthly.Containers)) +
geom_boxplot() +
facet_wrap(~ Year) +
labs(title = "Monthly Containers", subtitle="by company per year",
y = "Monthly Containers (100k)", x = "Company")
df2 <- df %>%
group_by(Month) %>%
summarise(Monthly.Carloads = sum(Carloads))
View(df)
View(df2)
View(df2)
cdf2 <- cdf %>%
group_by(Year,Month, Commodity, Company) %>%
summarise(Monthly.Carloads = sum(Carloads), .groups="keep")
cdf <- cdf %>%
group_by(Year,Month, Commodity, Company) %>%
summarise(Monthly.Carloads = sum(Carloads), .groups="keep")
df <- merge(cdf,idf, all=T)
cdf %>%
group_by(Month,Year,Company, Commodity) %>%
filter(Commodity == "Containers") %>%
summarise(Monthly.Containers = sum(Carloads)) %>%
ggplot(aes(x = fct_reorder(Company, Monthly.Containers), y= Monthly.Containers)) +
geom_boxplot() +
facet_wrap(~ Year) +
labs(title = "Monthly Containers", subtitle="by company per year",
y = "Monthly Containers (100k)", x = "Company")
library(dplyr)
library(tidyr)
library(ggplot2)
library(lubridate)
cdf <- read.csv("carloads.csv")
idf <- read.csv("ism.csv")
cdf <- cdf %>%  filter(Measure=='Weekly Carloads By 22 Commodity Categories' & Sub.Variable == 'Total')
cdf <- cdf %>% pivot_longer(!c(1:6), names_to = "Week", values_to = "Carload")
str(cdf)
cdf <- cdf %>% select(Company, Commodity=Variable, Week, Carloads=Carload)
cdf$Week <- sub("^X","",cdf$Week)
cdf$Carloads <- as.numeric(sub(",", "", cdf$Carloads))
cdf$Week <- as.Date(cdf$Week, "%m.%d.%Y")
# cdf$Month <- month(cdf$Week)
# cdf$Year <- year(cdf$Week)
# idf$Month <- month(mdy(idf$Date))
# idf$Year <- year(mdy(idf$Date))
#
cdf <- cdf %>%
mutate(Month= month(ymd(Week)),
Year= year(ymd(Week)))
idf <- idf %>%
mutate(Month= month(mdy(Date)),
Year= year(mdy(Date)))
cdf_gr <- cdf %>%
group_by(Year,Month, Commodity, Company) %>%
summarise(Monthly.Carloads = sum(Carloads), .groups="keep")
df <- merge(cdf_gr,idf, all=T)
library(forcats)
cdf %>%
group_by(Month,Year,Company, Commodity) %>%
filter(Commodity == "Containers") %>%
summarise(Monthly.Containers = sum(Carloads)) %>%
ggplot(aes(x = fct_reorder(Company, Monthly.Containers), y= Monthly.Containers)) +
geom_boxplot() +
facet_wrap(~ Year) +
labs(title = "Monthly Containers", subtitle="by company per year",
y = "Monthly Containers (100k)", x = "Company")
df2 <- df %>%
group_by(Month) %>%
summarise(Monthly.Carloads = sum(Carloads))
View(cdf2)
cor(df$Index, df$Monthly.Carloads)
cor(df$Index, df$Monthly.Carloads, use = "complete.obs")
df %>%
group_by(Month) %>%
filter(Commodity=="Crushed Stone, Sand and Gravel")
df %>%
group_by(Month) %>%
filter(Commodity=="Crushed Stone, Sand and Gravel") %>%
summarise(TotMonCarloads = sum(Monthly.Carloads), .groups = "keep")
df %>%
group_by(Month) %>%
filter(Commodity=="Crushed Stone, Sand and Gravel") %>%
mutate(TotMonCarloads = sum(Monthly.Carloads)) %>%
ggplot(aes(y=Index,x=))
df %>%
group_by(Month) %>%
filter(Commodity=="Crushed Stone, Sand and Gravel") %>%
mutate(TotMonCarloads = sum(Monthly.Carloads))
df %>%
group_by(Month) %>%
mutate(TotMonCarloads = sum(Monthly.Carloads)) %>%
filter(Commodity=="Crushed Stone, Sand and Gravel") %>%
ggplot(aes(x=Index,y=TotMonCarloads)) +
geom_point(color=Year)
df %>%
group_by(Month) %>%
mutate(TotMonCarloads = sum(Monthly.Carloads)) %>%
filter(Commodity=="Crushed Stone, Sand and Gravel") %>%
ggplot(aes(x=Index,y=TotMonCarloads)) +
geom_point(color=Year, stat = 'identity')
df %>%
group_by(Month) %>%
mutate(TotMonCarloads = sum(Monthly.Carloads)) %>%
filter(Commodity=="Crushed Stone, Sand and Gravel")
df %>%
group_by(Month) %>%
mutate(TotMonCarloads = sum(Monthly.Carloads)) %>%
filter(Commodity=="Crushed Stone, Sand and Gravel") %>%
ggplot(aes(x=Index,y=TotMonCarloads, fill = Year)) +
geom_point()
df %>%
group_by(Month) %>%
mutate(TotMonCarloads = sum(Monthly.Carloads)) %>%
filter(Commodity=="Crushed Stone, Sand and Gravel") %>%
ggplot(aes(x=Index,y=TotMonCarloads)) +
geom_point()
df %>%
group_by(Month) %>%
mutate(TotMonCarloads = sum(Monthly.Carloads)) %>%
filter(Commodity=="Crushed Stone, Sand and Gravel")
df %>%
group_by(Month, Year) %>%
mutate(TotMonCarloads = sum(Monthly.Carloads)) %>%
filter(Commodity=="Crushed Stone, Sand and Gravel")
df %>%
group_by(Month, Year) %>%
mutate(TotMonCarloads = sum(Monthly.Carloads)) %>%
filter(Commodity=="Crushed Stone, Sand and Gravel") %>%
ggplot(aes(x=Index,y=TotMonCarloads)) +
geom_point()
df %>%
group_by(Month, Year) %>%
mutate(TotMonCarloads = sum(Monthly.Carloads)) %>%
filter(Commodity=="Crushed Stone, Sand and Gravel") %>%
ggplot(aes(x=Index,y=TotMonCarloads, fill = Year)) +
geom_point()
df %>%
group_by(Month, Year) %>%
mutate(TotMonCarloads = sum(Monthly.Carloads)) %>%
filter(Commodity=="Crushed Stone, Sand and Gravel") %>%
ggplot(aes(x=Index,y=TotMonCarloads, color = Year)) +
geom_point()
df %>%
group_by(Month, Year) %>%
mutate(TotMonCarloads = sum(Monthly.Carloads)) %>%
filter(Commodity=="Crushed Stone, Sand and Gravel") %>%
ggplot(aes(x=Index,y=TotMonCarloads)) +
geom_point(color = Year)
df %>%
group_by(Month, Year) %>%
mutate(TotMonCarloads = sum(Monthly.Carloads)) %>%
filter(Commodity=="Crushed Stone, Sand and Gravel") %>%
ggplot(aes(x=Index,y=TotMonCarloads)) +
geom_point(color = Year, stat= "identity")
df %>%
group_by(Month, Year) %>%
mutate(TotMonCarloads = sum(Monthly.Carloads)) %>%
filter(Commodity=="Crushed Stone, Sand and Gravel") %>%
ggplot(aes(x=Index,y=TotMonCarloads)) +
geom_point(stat= "identity")
df %>%
group_by(Month, Year) %>%
mutate(TotMonCarloads = sum(Monthly.Carloads)) %>%
filter(Commodity=="Crushed Stone, Sand and Gravel") %>%
ggplot(aes(x=Index,y=TotMonCarloads)) +
geom_point()
df %>%
group_by(Month, Year) %>%
mutate(TotMonCarloads = sum(Monthly.Carloads)) %>%
filter(Commodity=="Crushed Stone, Sand and Gravel") %>%
ggplot(aes(x=Index,y=TotMonCarloads)) +
geom_point(aes(color=Year))
df %>%
group_by(Month, Year) %>%
mutate(TotMonCarloads = sum(Monthly.Carloads)) %>%
filter(Commodity=="Crushed Stone, Sand and Gravel") %>%
ggplot(aes(x=Index,y=TotMonCarloads)) +
geom_point(aes(color=factor(Year)))
df %>%
group_by(Month, Year) %>%
mutate(TotMonCarloads = sum(Monthly.Carloads)) %>%
filter(Commodity=="Crushed Stone, Sand and Gravel") %>%
ggplot(aes(x=Index,y=TotMonCarloads)) +
geom_point(aes(color=factor(Year))) +
labs(title = "Crushed Stone, Sand and Gravel",
subtitle = "total carloads vs ISM index",
x = ISM Index, y = "Total Carloads (x1M)", color = "Year")
df %>%
group_by(Month, Year) %>%
mutate(TotMonCarloads = sum(Monthly.Carloads)) %>%
filter(Commodity=="Crushed Stone, Sand and Gravel") %>%
ggplot(aes(x=Index,y=TotMonCarloads)) +
geom_point(aes(color=factor(Year))) +
labs(title = "Crushed Stone, Sand and Gravel",
subtitle = "total carloads vs ISM index",
x = "ISM Index", y = "Total Carloads (x1M)", color = "Year")
df %>%
group_by(Month, Year) %>%
mutate(TotMonCarloads = sum(Monthly.Carloads)) %>%
filter(Commodity=="Crushed Stone, Sand and Gravel") %>%
ggplot(aes(x=Index,y=TotMonCarloads)) +
geom_point(aes(color=factor(Year))) +
labs(title = "Crushed Stone, Sand, and Gravel",
subtitle = "total carloads vs ISM index",
x = "ISM Index", y = "Total Carloads (x1M)", color = "Year")
knitr::opts_chunk$set(message = FALSE, warning=F)
library(dplyr)
library(tidyr)
library(ggplot2)
library(lubridate)
carloads = read.csv("./carloads.csv", stringsAsFactors = F)
knitr::opts_chunk$set(message = FALSE, warning=F)
library(dplyr)
library(tidyr)
library(ggplot2)
library(lubridate)
carloads = read.csv("./carloads.csv", stringsAsFactors = F)
ism = read.csv("./ism.csv", stringsAsFactors = F)
carloads <- carloads %>%
filter(
Measure == 'Weekly Carloads By 22 Commodity Categories',
Sub.Variable == 'Total'
)
carloads <- carloads %>%
pivot_longer(
X3.29.2017:X10.7.2020, "Week", values_to = "Carloads"
)
carloads <- carloads %>% select(
Company, Commodity=Variable, Week, Carloads
)
carloads <- carloads %>%
mutate(
Week = gsub("X", "", Week),
Carloads = gsub(",", "", Carloads)
)
carloads <- carloads %>%
mutate(
Carloads = as.numeric(Carloads)
)
carloads <- carloads %>%
mutate(
Week = as.Date(Week, "%m.%d.%Y")
)
ism <- ism %>% mutate(Date=as.Date(Date, "%m/%d/%Y"))
carloads <- carloads %>%
mutate(
Year = year(Week),
Month = month(Week)
)
ism <- ism %>%
mutate(
Year = year(Date),
Month = month(Date)
)
carloads <- carloads %>%
group_by(Company, Commodity, Year, Month) %>%
summarise(Carloads = sum(Carloads))
df <- carloads %>%
inner_join(ism, by=c("Year","Month"))
df %>%
filter(Commodity=="Containers") %>%
ggplot() +
geom_boxplot(
aes(Company, Carloads),
) +
facet_grid(Year~.) +
scale_y_continuous(labels = scales::comma) +
theme(text = element_text(size=10)) # The last two lines are for aesthetic purposes and are not necessary
df %>%
group_by(Company, Commodity) %>%
summarise(correlation=cor(Carloads, Index)) %>%
arrange(desc(correlation)) %>%
head(10) %>%
knitr::kable() # This is a function that produces a table that is better displayed in an html file rendered from R Markdown.
df %>%
filter(Commodity=="Crushed Stone, Sand and Gravel")  %>%
mutate(Year=as.factor(Year)) %>%
group_by(Year, Month) %>%
summarise(Carloads = sum(Carloads), Index=first(Index)) %>%
ggplot() +
geom_point(aes(Carloads, Index, color=Year))
getwd()
setwd("C:/Users/hzeig/Documents/Data Science/NYCDSA/projects/Reddit/shiny_app")
